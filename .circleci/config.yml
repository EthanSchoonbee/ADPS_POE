# This config was automatically generated from your source code
# Stacks detected: cicd:github-actions:.github/workflows,deps:node:frontend,test:jest:
version: 2.1
orbs:
  node: circleci/node@5
jobs:
  say-hello:
      # Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
      # See: https://circleci.com/docs/configuration-reference/#executor-job
      docker:
        - image: cimg/base:stable
      # Add steps to the job
      # See: https://circleci.com/docs/configuration-reference/#steps
      steps:
        - checkout
        - run:
            name: "Say hello"
            command: "echo Hello, World!"

    sonarqube:
      working_directory: ~/build
      docker:
        - image: sonarsource/sonar-scanner-cli
      resource_class: small
      steps:
        - run: apk update
        - run: apk upgrade
        - run: apk --no-cache add --update openssh git curl
        - checkout
        - run: find .
        - attach_workspace:
            at: ~/workspace
        - run: |
            SONAR_BRANCH="${CIRCLE_BRANCH:-master}"
            echo "Sonar branch value is: " $SONAR_BRANCH
            echo "Sonar org value is : "$SONAR_ORG
            sonar-scanner \
            -Dsonar.projectKey="$SONAR_PROJECT_KEY" \
            -Dsonar.organization="$SONAR_ORG" \
            -Dsonar.host.url=https://sonarcloud.io \
            -Dsonar.exclusions="**/android/**,**/ios/**" \
            -Dsonar.login="$SONAR_TOKEN" \
            -Dsonar.branch.name="$SONAR_BRANCH" \
            -Dsonar.sources="."
            
workflows:
  build-and-test:
    jobs:
      - say-hello
     # - sonarqube
      #- test-node
      #- build-node:
       #   requires:
        #    - test-node
